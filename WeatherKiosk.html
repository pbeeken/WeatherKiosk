<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="refresh" content="1800" />
        <link rel="preconnect" href="https://fonts.googleapis.com"/>
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
        <link href="https://fonts.googleapis.com/css2?family=Trade+Winds&display=swap" rel="stylesheet"/>    
        <link rel="stylesheet" type="text/css" href="WeatherKiosk.css"/>
        <meta http-equiv="content-type" content="text/html; charset=iso-8859-1"/>
    </head>

    <body onload="{startTime(); dothisnow();}">
        <div class="shell">
            <div class="header">
                <img class="logo" src="resources/HHYC_Flag.png"alt="HHYC Logo">
                <span class="title">Horseshoe Harbor Yacht Club Tides, Wind &amp; Weather</span> 
            </div>
            <div class="wrapper">
                <div class="box1"><iframe class="import" src="tideGraph.html"></iframe></div>
                <div class="box2"><iframe class="import" src="tideGraphic.html"></iframe></div>
                <div class="box3"><iframe class="import" src="tideTable.html"></iframe></div>
                <div class="box4"><iframe class="import" src="windGraph.html"></iframe></div>
                <div class="box5"><iframe class="import" src="forecastGrid.html"></iframe></div>
            </div>
            <div class="footer">
                <p id="clock">Waiting...</p>
                <p id="suncondition"><!--Sunrise and sunset--></p>
            </div>
        </div>
    </body>
    <script>
        function startTime() {
            const today = new Date()
            document.getElementById('clock').innerHTML =  today.toLocaleTimeString('en-US')
            setTimeout(startTime, 1000)
            }

        function loadCSV(callback) {   
            var xobj = new XMLHttpRequest();
            xobj.overrideMimeType("application/json");
            let url = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTNicoE1m6n7XfxcWa-inkdc0RmE_QcWepnUa4PxKFA3UB-uzMvCsUhAjsl9cc8IPQT6Fct4wKMvm4N/pub?gid=281261321&single=true&output=csv"
            xobj.open('GET', url, true);
            xobj.onreadystatechange = function () {
                if (xobj.readyState == 4 && xobj.status == "200") {
                    //callback(JSON.parse(xobj.responseText))
                    let resp = (xobj.responseText).replace(/\r/g,"") // eliminate the lf
                    resp = resp.split("\n")
                    for (i in resp)
                        resp[i] = resp[i].split(",").slice(1)
                    callback(resp.slice(2))
                    }
                }
            xobj.send(null);  
            }

        function processText(rc) {
            let now = new Date()
            let time = now.getHours()*60. + now.getMinutes()  // minutes past midnight
            let todaySunset = 60. * parseInt(rc[2][4].slice(0,2)) + parseInt(rc[2][4].slice(3,5)) // minutes past midnight
            //console.log(`-${time}-${todaySunset}- ${time > (20 + todaySunset)}`)
            if (time < (20 + todaySunset)) // 20 min after sunset switch to tomorrow's datum
                document.getElementById("suncondition").innerHTML = `${rc[1][0]}, ${rc[1][1]} Sunrise is at ${rc[1][3].slice(0,-3)}, Sunset at ${rc[1][4].slice(0,-3)}`  // today
            else
                document.getElementById("suncondition").innerHTML = `${rc[2][0]}, ${rc[2][1]} Sunrise is at ${rc[2][3].slice(0,-3)}, Sunset at ${rc[2][4].slice(0,-3)}`  // tomorrow

            }

        function dothisnow() {
            loadCSV(processText)
            }
    </script>
</html>




